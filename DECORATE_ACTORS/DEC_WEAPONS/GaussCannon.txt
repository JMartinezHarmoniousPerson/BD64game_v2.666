Actor BD64_GaussCannonSpawner : CustomInventory 
{
Scale 0.9
//+INVENTORY.ALWAYSPICKUP		//R12.1 removed
Inventory.PickupMessage "You picked up the Gauss Cannon"
Inventory.PickupSound "WPICK"
	States
	{
	Spawn:
		GCPC A -1
		Stop
	Pickup:
		TNT1 A 0 A_JumpIfInventory("IsTacticalClass",1,"Pickup2")
		TNT1 A 0 A_JumpIfInventory("IsModern",1,"Pickup2")
		TNT1 A 0 A_GiveInventory("BD64_GaussCannon")
		Stop
	Pickup2:
		TNT1 A 0 A_GiveInventory("BD64_GaussCannonTactical")
		Stop
	}
}

ACTOR BD64_GaussCannon : DoomWeapon
{
SpawnID 164
Radius 20
Height 16
Weapon.Selectionorder 100
Weapon.AmmoUse 10
Weapon.AmmoGive 40
Weapon.AmmoType "Cell"
Inventory.Pickupmessage "You picked up the Gauss Cannon"
Obituary "%o was pierced by %k's Gauss Cannon"
Tag "Gauss Cannon"
//Weapon.SlotNumber 7
VisibleToPlayerClass "64DoomPlayer"
Inventory.ForbiddenTo "Tactical64DoomPlayer","Tactical64DoomPlayer_P","Modern"
Decal BigScorch
+INVENTORY.RESTRICTABSOLUTELY
	States
	{
	Ready:
		TNT1 A 0 A_ZoomFactor(1.0)
		GCID A 1 A_WeaponReady
		Loop
	Deselect:
		GCID A 1 A_Lower
		Wait
	Select:
		GCID A 1 A_Raise
		Loop
	Fire:
		TNT1 A 0 A_PlaySound("GaussCannon/Fire")
		TNT1 A 0 A_ZoomFactor(0.95)
		TNT1 A 0 A_RailAttack(random(250,400),0,1,None,None,RGF_FULLBRIGHT|RGF_SILENT,0,"GaussCannonProjectilePuff",0,0,0,0,5,0,"GaussCannonProjectileTrail",-5)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*2,0,sin(pitch)*2,CVF_RELATIVE)
		TNT1 A 0 A_CheckFloor(2)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*12,0,sin(pitch)*12,CVF_RELATIVE)
		GCFI AB 2 Bright A_ZoomFactor(1)
		GCFI C 5
		GCFI DEF 1
		GCID A 20
		goto Ready
	Spawn:
		GCPC A -1
		stop
	}
}

Actor GaussAmmo : Ammo
{
Inventory.Amount 0
Inventory.MaxAmount 10
Ammo.BackpackAmount 0
Ammo.BackpackMaxAmount 10
Inventory.Icon "GCPCA0"
+IGNORESKILL
}

ACTOR BD64_GaussCannonTACTICAL : Brutal64Weapon
{
SpawnID 164
Radius 20
Height 16
Weapon.Selectionorder 100
Weapon.AmmoUse1 1
Weapon.AmmoGive1 40
Weapon.AmmoType1 "Cell"
Weapon.AmmoUse2 1
Weapon.AmmoGive2 0
Weapon.AmmoType2 "GaussAmmo"
Inventory.Pickupmessage "You picked up the Gauss Cannon"
Obituary "%o was pierced by %k's Gauss Cannon"
Tag "Gauss Cannon"
//Weapon.SlotNumber 7
VisibleToPlayerClass "Tactical64DoomPlayer","Tactical64DoomPlayer_P","Modern"
Inventory.ForbiddenTo "64DoomPlayer"
Decal BigScorch
+INVENTORY.RESTRICTABSOLUTELY
+WEAPON.AMMO_CHECKBOTH
+WEAPON.PRIMARY_USES_BOTH
	States
	{
	KickingFlash:
		GCIK ABCD 1
		GCIK D 8
		GCIK DCBA 1
		Stop
	AirKickingFlash:
		GCIK ABCD 1
		GCIK D 10
		GCIK DCBA 1
		Stop
	SlideKickingStart:
		GCIK ABCD 1
		GCIK D 18
	SlideKickingEnd:
		GCIK D 6
		GCIK DCBA 1
		Stop
	v1Ready:
	Ready:
		TNT1 A 0 A_JumpIfInventory("Kicking",1,"DoKick")
		TNT1 A 0 A_ZoomFactor(1.0)
		TGCI A 1 A_WeaponReady(WRF_ALLOWRELOAD)
		Loop
	Deselect:
		TGCS DCBA 1
		TNT1 A 1 A_Lower
		Wait
	Select:
		TNT1 A 0 A_PlaySound("GAUDR1")
		TNT1 AAAAAAAA 0 A_Raise
		Goto SelectAnimation
	SelectAnimation:
		TGCS ABCD 1
		Goto Ready
	Fire:
		TNT1 A 0 A_JumpIfInventory("GaussAmmo",1,1)
		Goto Reload
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto Fire1
		TNT1 A 0 A_PlaySound("GaussCannon/Fire")
		TNT1 A 0 A_ZoomFactor(0.90)
		TNT1 A 0 A_RailAttack(random(250,400),0,1,None,None,RGF_FULLBRIGHT|RGF_SILENT,0,"GaussCannonProjectilePuff",0,0,0,0,5,0,"GaussCannonProjectileTrail",-5)
		TNT1 A 0 A_GiveInventory("Cell",1)
//		TNT1 A 0 A_TakeInventory("GaussAmmo",1)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*2,0,sin(pitch)*2,CVF_RELATIVE)
		TNT1 A 0 A_CheckFloor(2)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*12,0,sin(pitch)*12,CVF_RELATIVE)
		TGCF AB 2 Bright A_ZoomFActor(1.0)
		TGCF C 5
		TGCF DEF 1
		TGCI A 20
		goto Ready
	Fire1:
		TNT1 A 0 A_JumpIfInventory("GaussAmmo",1,1)
		Goto Reload
		TNT1 A 0 A_PlaySound("GaussCannon/Fire")
		TNT1 A 0 A_ZoomFactor(0.90)
		TNT1 A 0 A_RailAttack(random(250,400),0,1,None,None,RGF_FULLBRIGHT|RGF_SILENT,0,"GaussCannonProjectilePuff",0,0,0,0,5,0,"GaussCannonProjectileTrail",-5)
//		TNT1 A 0 A_GiveInventory("Cell",1)
//		TNT1 A 0 A_TakeInventory("GaussAmmo",1)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*2,0,sin(pitch)*2,CVF_RELATIVE)
		TNT1 A 0 A_CheckFloor(2)
		TNT1 A 0 A_ChangeVelocity(-cos(-pitch)*12,0,sin(pitch)*12,CVF_RELATIVE)
		TGCF AB 2 Bright A_ZoomFActor(1.0)
		TGCF C 5
		TGCF DEF 1
		TGCI A 20
		goto Ready
	Reload:
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto Ready
		TNT1 A 0 A_ZoomFactor(1.0)
		TNT1 A 0 A_JumpIfInventory("GaussAmmo",10,"Ready")
//		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
//		Goto NoAmmo
		GCRL ABC 1
		GCRL C 2 Offset(0,32)
		GCRL D 5 Offset(0,35) A_PlaySound("Railgun/Eject",CHAN_WEAPON)
		GCRL D 2 Offset(0,32)
		GCRL D 6
		GCFL ABC 1
		TNT1 A 0 A_JumpIfInventory("GaussAmmo",1,"FullReload")
		TNT1 A 0 A_PlaySound("RAILMAG1",CHAN_WEAPON)
		GCEL ABCDDEFGHIJKLMNOP 1
		TNT1 A 0 A_FireCustomMissile("EmptyCellPack",-30,0,-11,-24)
		GCEL QRR 1
		GCRL E 10
		Goto FinishReload
	FullReload:
		TNT1 A 0 A_PlaySound("RAILMAG1",CHAN_WEAPON)
		GCFL DDEFGHIJKLMN 1
		GCRL E 10
	FinishReload:
		GCBL AABBCCDEFGHIJK 1
		TNT1 A 0 A_PlaySound("RAILMAG2",CHAN_WEAPON)
		GCBL LLMNOPQRS 1
	InsertBullets:
		TNT1 A 0 A_JumpIfInventory("GaussAmmo",10,"Ready")
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto Ready
		TNT1 A 0 A_Giveinventory("GaussAmmo",1)
		TNT1 A 0 A_Takeinventory("Cell",10)
		Goto InsertBullets
		TNT1 A 0 A_Refire
		Goto Ready
	Spawn:
		GCPC A -1
		stop
	}
}

Actor GaussCannonProjectilePuff
{
+ALWAYSPUFF
-NOCLIP
+NOGRAVITY
+PIERCEARMOR
+EXTREMEDEATH
+FORCEXYBILLBOARD
Alpha 1
Translation "0:255=%[0,0,0]:[0.4,1.0,2.0]"
RenderStyle Add
DamageType "Plasma"
Scale 1.5
	States
	{
	Spawn:
		TNT1 A 0
	Death:
		TNT1 A 0 A_SpawnItemEx("DetectCeilCrater",0,0,0,0,0,0,0,0,0)
		TNT1 A 0 A_SpawnItemEx("DetectFloorCrater",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0)
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_CustomMissile("BluePlasmaParticle",0,0,random(0,360),2,random(0,360))
		TNT1 AAAA 0 A_SpawnItem("LensFlareTorchBlue",0,0)
		GEXP BCDEFGHIJKL 2 Bright
		GEXP MNOPQR 2 Bright A_CustomMissile("PlasmaSmoke",1,0,random(0,360),2,random(0,160))
		GEXP STUVWXYZ 2 Bright
	Stop
	}
}

Actor GaussCannonProjectileTrail
{
+ALWAYSPUFF
+NOBLOCKMAP
+NOGRAVITY
+PIERCEARMOR
+NOINTERACTION
+FORCEXYBILLBOARD
Alpha 0.6
RenderStyle Add
Scale 0.7
	States
	{
	Spawn:
	GCPR A 1 Bright A_SetScale (0.6)
	GCPR A 1 Bright A_SetScale (0.55)
	GCPR A 1 Bright A_SetScale (0.5)
	GCPR A 1 Bright A_SetScale (0.45)
	GCPR A 1 Bright A_SetScale (0.4)
	GCPR A 1 Bright A_SetScale (0.35)
	GCPR A 1 Bright A_SetScale (0.3)
	GCPR A 1 Bright A_SetScale (0.25)
	GCPR A 1 Bright A_SetScale (0.2)
	GCPR A 1 Bright A_SetScale (0.15)
	GCPR A 1 Bright A_SetScale (0.1)
	GCPR A 1 Bright A_SetScale (0.05)
	GCPR A 1 Bright A_SetScale (0.0)
	Stop
	}
}

ACTOR EmptyCellPack
{
Scale 0.9
Height 2
Radius 2
Speed 4
Mass 6
SeeSound "weapons/largemagdrop"
-NOGRAVITY
-DROPOFF
+WINDTHRUST
+CLIENTSIDEONLY
+MOVEWITHSECTOR
+MISSILE
+NOBLOCKMAP
+NOTELEPORT
+FORCEXYBILLBOARD
+NOTDMATCH
+GHOST
+ISMONSTER
	States
	{
	Spawn:
		TNT1 A 0 NODELAY A_JUMP(128,2)
		TNT1 A 0 A_SETSCALE(0-ScaleX,ScaleY)
		ECLP A 4 A_CheckFloor("Death")
		WAIT
	Death:
		TNT1 A 0 ACS_NamedExecuteAlways("LowBloodCheckerACS")
		ECLP A 600
		TNT1 A 0 A_JumpIfInventory("LowGraphicsMode",1,"Stoping")
		Loop
	Stoping:
		TNT1 A 0
		Stop
	}
}
