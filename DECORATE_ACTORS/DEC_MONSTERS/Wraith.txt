Actor 64Wraith 19123
{
Scale 0.8
Health 300
GibHealth 100
Height 48
Radius 19
Mass 200
Speed 14
Fastspeed 16
MeleeRange 64 //default 44
MeleeThreshold 128
PainChance 128
PainChance "SuperFists",255
PainChance "Kick",255
PainChance "SuperKick",255
DamageFactor "CauseWaterSplash",0.0
DamageFactor "CauseObjectsToSplash",0.0
DamageFactor "chainsaw",1
DamageFactor "Head",1
Alpha 0.6
RenderStyle Translucent
Obituary "%o was slit open by a Wraith"
SeeSound "Roach/Sight"
PainSound "Roach/Pain"
DeathSound "Roach/Death"
ActiveSound "Roach/Active"
Tag "Wraith"
DropItem "DemonEssenceSpawner"
BloodType "Brutal_Blood"
MONSTER
+SHADOW
+FLOORCLIP
+NOBLOODDECALS
	States
	{
	Spawn:
		3WRT AAAAAAAA 2 A_Look
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)	//Staying still lowers teleport cooldown
		Loop
	See:
		TNT1 A 0 A_ChangeFlag("AMBUSH",1)							//The Wraith will not attack when hearing the player...
		TNT1 A 0 A_ChangeFlag("LOOKALLAROUND",1)					//...but he stays alert and looks all around him
		TNT1 A 0 A_JumpIfInventory("MonsterHaveSeenPlayer",1,3)		//Check if the Wraith has "woken"
		//The following happens only the first time the Wraith hears the player and "wakes up"
		TNT1 A 0 A_GiveInventory("MonsterHaveSeenPlayer",1)			//Give this token so that we know that the Wraith has "woken"
		TNT1 A 0 A_CheckSight("Hide")								//If the Wraith can't see the player when "woken" he will stay where he are and wait for an ambush
		//The following is normal chase code
		TNT1 A 0 A_Jump(205,2)										//20% chance that the Wraith will hide if he can't see the player
		TNT1 A 0 A_CheckSight("Hide")
		3WRT BB 2 A_Chase
		3WRT CC 2 A_Chase
		3WRT DD 2 A_Chase
		3WRT EE 2 A_Chase
		TNT1 A 0 A_JumpIfInventory("WraithTeleportCooldown",1,2)	//If cooldown is ready, the Wraith may try to teleport
		TNT1 A 0 A_Jump(256,"Teleport")
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)		//Moving lowers teleport cooldown
		Loop
	Hide: //Staying still and waiting in ambush.
		TNT1 A 0 A_ChangeFlag("AMBUSH",1)
		3WRT AAAAAAAA 2 A_Look
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)	//Staying still lowers teleport cooldown
		Loop
	Melee:
		TNT1 A 0 A_JumpIfInventory("FireSeq",1,"Melee2")
		3WRT AAA 2 A_FaceTarget
		TNT1 A 0 A_PlayWeaponSound("D3Wraith/Attack")
		TNT1 A 0 A_Recoil(-1)
		3WRT FF 3 A_FaceTarget
		3WRT G 6 A_CustomMeleeAttack(5*random(1,8),"D3Wraith/Hit")
		3WRT AA 2
		TNT1 A 0 A_GiveInventory("FireSeq",1)
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)	//Attacking lowers teleport cooldown
		Goto See
	Melee2:
		3WRT AAA 2 A_FaceTarget
		TNT1 A 0 A_SetScale(0-ScaleX,ScaleY)
		TNT1 A 0 A_PlayWeaponSound("D3Wraith/Attack")
		TNT1 A 0 A_Recoil(-1)
		3WRT FF 3 A_FaceTarget
		3WRT G 6 A_CustomMeleeAttack(5*random(1,8),"D3Wraith/Hit")
		3WRT AA 2
		TNT1 A 0 A_TakeInventory("FireSeq",1)
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)	//Attacking lowers teleport cooldown
		TNT1 A 0 A_SetScale(0-ScaleX,ScaleY)
		Goto See
	Pain:
		TNT1 A 0 A_TakeInventory("WraithTeleportCooldown",1)		//Attacking the Wraith reduces the phantoms teleport cooldown
		TNT1 A 0 A_CheckSight("Retaliate")							//If taking damage but can't see the player, try to run away
		TNT1 A 0 A_JumpIfInventory("WraithTeleportCooldown",1,2)	//If cooldown is ready, the Wraith may try to teleport
		TNT1 A 0 A_Jump(256,"Teleport")
		3WRT A 3 A_Jump(192,2)										//Since the Wraith has a high painchance, we make it more quiet
		TNT1 A 0 A_Pain
		3WRT A 3
		Goto See
	Retaliate:
		TNT1 A 0 A_Pain
		3WRT BBB 1 A_Wander
		3WRT CCC 1 A_Wander
		3WRT DDD 1 A_Wander
		3WRT EEE 1 A_Wander
		Goto Hide
	Teleport:
		TNT1 A 0 A_JumpIfCloser(1024,2)			//Closer than 1024 units it will try to teleport closer
		TNT1 A 0 A_Jump(256,"TeleportHideOut")	//Longer than 1024 units it will try to teleport into hiding
		Goto See
		TNT1 A 0 A_Jump(256,"TeleportAttackOut")
		Goto See
	TeleportAttackOut:
		3WRT A 1 A_FaceTarget
		TNT1 A 0 A_GiveInventory("WraithTeleportCooldown",10)
		TNT1 A 0 A_ChangeFlag("Invulnerable",1)
		TNT1 A 0 A_ChangeFlag("NonShootable",1)
		TNT1 A 0 A_ChangeFlag("Shootable",0)
		TNT1 A 0 A_ChangeFlag("NoTeleport",1)
		TNT1 A 0 A_ChangeFlag("NoRadiusDMG",1)
		TNT1 AAAA 0 A_CustomMissile("WraithSmoke",random(10,30),0,random(0,360),2,random(10,80))
		3WRT AAAAAAAAAA 1 A_Fadeout(0.06)
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
		TNT1 A 0 A_JumpIfCloser(128,"TeleportAttackIn")
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
		TNT1 A 0 A_JumpIfCloser(128,"TeleportAttackIn")
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
		TNT1 A 0 A_JumpIfCloser(128,"TeleportAttackIn")
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
		TNT1 A 0 A_JumpIfCloser(128,"TeleportAttackIn")
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
		TNT1 A 0 A_JumpIfCloser(128,"TeleportAttackIn")
		3WRT AAAAAAAAAAAAA 0 A_Chase("","")
	TeleportAttackIn:
		TNT1 A 0 A_Jump(256,1,2,3)
		TNT1 AAAA 5	//random delay
		TNT1 AAAA 0 A_CustomMissile("WraithSmoke",random(10,30),0,random(0,360),2,random(10,80))
		3WRT AAAAAAAAAA 1 A_Fadein(0.06)
		TNT1 A 0 A_ChangeFlag("Invulnerable",0)
		TNT1 A 0 A_ChangeFlag("NonShootable",0)
		TNT1 A 0 A_ChangeFlag("Shootable",1)
		TNT1 A 0 A_ChangeFlag("NoTeleport",0)
		TNT1 A 0 A_ChangeFlag("NoRadiusDMG",0)
		3WRT A 6
		TNT1 A 0 A_FaceTarget
		Goto See
	TeleportHideOut:
		3WRT A 1 A_FaceTarget
		TNT1 A 0 A_GiveInventory("WraithTeleportCooldown",10)
		TNT1 A 0 A_ChangeFlag("Invulnerable",1)
		TNT1 A 0 A_ChangeFlag("NonShootable",1)
		TNT1 A 0 A_ChangeFlag("Shootable",0)
		TNT1 A 0 A_ChangeFlag("NoTeleport",1)
		TNT1 A 0 A_ChangeFlag("NoRadiusDMG",1)
		TNT1 AAAA 0 A_CustomMissile("WraithSmoke",random(10,30),0,random(0,360),2,random(10,80))
		3WRT AAAAAAAAAA 1 A_Fadeout(0.06)
		3WRT AAAAAAAAAAAAA 0 A_Wander
		TNT1 A 0 A_CheckSight("TeleportHideIn")
		3WRT AAAAAAAAAAAAA 0 A_Wander
		TNT1 A 0 A_CheckSight("TeleportHideIn")
		3WRT AAAAAAAAAAAAA 0 A_Wander
		TNT1 A 0 A_CheckSight("TeleportHideIn")
		3WRT AAAAAAAAAAAAA 0 A_Wander
		TNT1 A 0 A_CheckSight("TeleportHideIn")
		3WRT AAAAAAAAAAAAA 0 A_Wander
		TNT1 A 0 A_CheckSight("TeleportHideIn")
		3WRT AAAAAAAAAAAAA 0 A_Wander
	TeleportHideIn:
		TNT1 A 0 A_Jump(256,1,2,3)
		TNT1 AAAA 5	//random delay
		TNT1 AAAA 0 A_CustomMissile("WraithSmoke",random(10,30),0,random(0,360),2,random(10,80))
		3WRT AAAAAAAAAA 1 A_Fadein(0.06)
		TNT1 A 0 A_ChangeFlag("Invulnerable",0)
		TNT1 A 0 A_ChangeFlag("NonShootable",0)
		TNT1 A 0 A_ChangeFlag("Shootable",1)
		TNT1 A 0 A_ChangeFlag("NoTeleport",0)
		TNT1 A 0 A_ChangeFlag("NoRadiusDMG",0)
		3WRT A 6
		TNT1 A 0 A_FaceTarget
		Goto Hide
	Raise:
		3WRT LKJIH 5
		Goto See
	Crush:
		TNT1 A 0 A_PlaySound("Misc/Gibbed")
		POL5 A -1
		Stop
	Death:
		TNT1 A 0 A_Scream
		TNT1 AA 0 A_CustomMissile("Blood",25,0,random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",25,0,random(0,360),2,random(0,180))
		3WRT HIJK 5 A_CustomMissile("Brutal_FlyingBlood",20,0,random(0,360),2,random(0,180))
		TNT1 A 0 A_NoBlocking
		3WRT L -1 A_SpawnItem("GrowingBloodPool")
		Stop
	Death.Chainsaw:
		TNT1 AAAAAA 0 A_CustomMissile("CeilBloodLauncher",0,0,random(0,360),2,random(50,130))
		TNT1 A 0 A_XScream
		TNT1 A 0 A_CustomMissile("XDeath1",32,0,random(0,360),2,random(0,160))
		TNT1 AA 0 A_CustomMissile("Blood",21,random(-7,7),random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",25,random(-7,7),random(0,360),2,random(0,180))
		PTXC ABC 3 A_CustomMissile("Brutal_FlyingBlood",25,0,random(0,360),2,random(0,180))
		TNT1 A 0 A_NoBlocking
		TNT1 A 0 A_CustomMissile("Blood",18,random(-7,7),random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",21,random(-7,7),random(0,360),2,random(0,180))
		PTXC DEF 3 A_CustomMissile("Brutal_FlyingBlood",20,0,random(0,360),2,random(40,90))
		TNT1 A 0 A_CustomMissile("Blood",15,random(-7,7),random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",17,random(-7,7),random(0,360),2,random(0,180))
		PTXC GHI 3 A_CustomMissile("Brutal_FlyingBlood",16,0,random(0,360),2,random(55,90))
		TNT1 A 0 A_CustomMissile("Blood",12,random(-7,7),random(0,360),2,random(0,180))
		TNT1 A 0 A_CustomMissile("BloodMistSmall",13,random(-7,7),random(0,360),2,random(0,180))
		PTXC JKL 3 A_CustomMissile("Brutal_FlyingBlood",12,0,random(0,360),2,random(70,90))
		TNT1 A 0 A_CustomMissile("Blood",9,random(-7,7),random(0,360),2,random(0,180))
		TNT1 A 0 A_CustomMissile("BloodMistSmall",9,0,random(0,360),2,random(0,180))
		PTXC L -1 A_SpawnItem("GrowingBloodPool")
		Stop
	Death.Bullet:
		TNT1 A 0 A_Jump(192,"Death")//75%
		Goto XDeath
	Death.Rifle:
		TNT1 A 0 A_Jump(154,"Death")//60%
		Goto XDeath
	Death.Cutless:
		TNT1 A 0 A_Jump(85,"Death")//33%
		Goto XDeath
	Death.SuperFists:
	Death.SuperKick:
		TNT1 A 0 A_Jump(85,"Death")//33%
		Goto XDeath
	Xdeath:
	Death.BFG:
		TNT1 AAAAAA 0 A_CustomMissile("CeilBloodLauncher",0,0,random(0,360),2,random(50,130))
		TNT1 A 0 A_XScream
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_SpawnItemEx("WraithTorso",0,0,6,-2,0,5,0,128)
		TNT1 AAAA 0 A_CustomMissile("Instestin",32,0,random(0,360),2,random(0,90))
		TNT1 A 0 A_CustomMissile("XDeath1",30,0,random(0,360),2,random(0,160))
		TNT1 A 0 A_CustomMissile("Brutal_FlyingBlood",30,0,random(0,360),2,random(70,90))
		PTXB AB 3 A_CustomMissile("Brutal_FlyingBlood",25,0,random(0,360),2,random(70,90))
		TNT1 AAAA 0 A_CustomMissile("Bloodmist",35,0,random(0,360),2,random(0,90))
		TNT1 AAAAAA 0 A_CustomMissile("BloodmistBig",45,0,random(0,360),2,random(10,90))
		TNT1 A 0 A_NoBlocking
		PTXB CDE 3 A_CustomMissile("Brutal_FlyingBloodFake",20,0,random(0,360),2,random(70,90))
		PTXB FG 3 A_CustomMissile("Brutal_FlyingBlood",15,0,random(0,360),2,random(70,90))
		PTXB HH 3 A_CustomMissile("Brutal_FlyingBloodFake",10,0,random(0,360),2,random(70,90))
		PTXB H -1 A_SpawnItem("GrowingBloodPool")
		Stop
	Death.Shotgun:
		TNT1 AAA 0 A_CustomMissile("BloodmistBig",45,0,random(0,360),2,random(10,90))
		TNT1 A 0 A_CustomMissile("XDeathOrgan1",40,0,random(0,360),2,random(-5,5))
		TNT1 A 0 A_CustomMissile("XDeathOrgan2",40,0,random(0,360),2,random(-5,5))
		TNT1 A 0 A_JumpIfCloser(100,1)
		Goto Death
		TNT1 A 0 A_XScream
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_Recoil(4)
		TNT1 AAAAAA 0 A_CustomMissile("CeilBloodLauncher",0,0,random(0,360),2,random(50,130))
		TNT1 A 0 A_SpawnItemEx("WraithHead",0,0,36,frandom(-4,-5),frandom(-1,1),frandom(4,5),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithArm",0,15,18,frandom(-4,-5),frandom(1,3),frandom(4,5),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithArm",0,-15,18,frandom(-4,-5),frandom(-3,-1),frandom(4,5),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,0,30,frandom(-4,-5),frandom(-2,2),frandom(4,5),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,8,26,frandom(-4,-5),frandom(1,3),frandom(4,5),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,-8,22,frandom(-4,-5),frandom(-3,-1),frandom(4,5),0,128)
		TNT1 AA 0 A_CustomMissile("XDeath1",35,0,random(150,210),2,random(5,80))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",35,0,random(140,220),2,random(5,80))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",30,0,random(140,220),2,random(70,90))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBloodFake",35,0,random(140,220),2,random(5,80))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBloodFake",30,0,random(140,220),2,random(70,90))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",30,0,random(150,210),2,random(70,90))
		PTXB AB 3 A_CustomMissile("Brutal_FlyingBlood",25,0,random(150,210),2,random(70,90))
		TNT1 A 0 A_NoBlocking
		PTXB CDE 3 A_CustomMissile("Brutal_FlyingBloodFake",20,0,random(150,210),2,random(70,90))
		PTXB FG 3 A_CustomMissile("Brutal_FlyingBlood",15,0,random(150,210),2,random(70,90))
		PTXB HH 3 A_CustomMissile("Brutal_FlyingBloodFake",10,0,random(150,210),2,random(70,90))
		PTXB H -1 A_SpawnItem("GrowingBloodPool")
		Stop
	Death.SSG:
		TNT1 A 0 A_JumpIfCloser(170,1)
		Goto Death
		TNT1 A 0 A_XScream
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_Recoil(6)
		TNT1 AAAAAA 0 A_CustomMissile("CeilBloodLauncher",0,0,random(0,360),2,random(50,130))
		TNT1 A 0 A_SpawnItemEx("WraithHead",0,0,36,frandom(-6,-7),frandom(-1,1),frandom(6,7),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithArm",0,15,18,frandom(-6,-7),frandom(1,3),frandom(6,7),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithArm",0,-15,18,frandom(-6,-7),frandom(-3,-1),frandom(6,7),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,0,30,frandom(-6,-7),frandom(-2,2),frandom(6,7),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,8,26,frandom(-6,-7),frandom(1,3),frandom(6,7),0,128)
		TNT1 A 0 A_SpawnItemEx("WraithGib",0,-8,22,frandom(-6,-7),frandom(-3,-1),frandom(6,7),0,128)
		TNT1 AA 0 A_CustomMissile("XDeath1",35,0,random(150,210),2,random(5,80))
		TNT1 A 0 A_CustomMissile("XDeathOrgan1",40,0,random(0,360),2,random(-5,5))
		TNT1 A 0 A_CustomMissile("XDeathOrgan2",40,0,random(0,360),2,random(-5,5))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",35,0,random(140,220),2,random(5,80))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",30,0,random(140,220),2,random(70,90))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBloodFake",35,0,random(140,220),2,random(5,80))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBloodFake",30,0,random(140,220),2,random(70,90))
		PTXB AB 3 A_CustomMissile("Brutal_FlyingBlood",25,0,random(150,210),2,random(70,90))
		TNT1 A 0 A_NoBlocking
		PTXB CDE 3 A_CustomMissile("Brutal_FlyingBloodFake",20,0,random(150,210),2,random(70,90))
		PTXB FG 3 A_CustomMissile("Brutal_FlyingBlood",15,0,random(150,210),2,random(70,90))
		PTXB HH 3 A_CustomMissile("Brutal_FlyingBloodFake",10,0,random(150,210),2,random(70,90))
		PTXB H -1 A_SpawnItem("GrowingBloodPool")
		Stop
	Death.Plasma:
		TNT1 A 0 A_XScream
		TNT1 A 0 A_CustomMissile("Blood",16,0,random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",16,0,random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",16,0,random(0,360),2,random(0,180))
		PTXC ABC 3 A_CustomMissile("BluePlasmaFireNonStatic",32,0,random(0,360),2,random(0,180))
		TNT1 A 0 A_CustomMissile("Blood",16,0,random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("BloodMistSmall",16,0,random(0,360),2,random(0,180))
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",16,0,random(0,360),2,random(0,180))
		TNT1 A 0 A_NoBlocking
		PTXC DEF 3
		TNT1 A 0 A_SpawnItemEx("BurningFleshEffect2",0,0,5)
		TNT1 AA 0 A_CustomMissile("Brutal_FlyingBlood",16,0,random(0,360),2,random(0,180))
		TNT1 A 0 A_SpawnItemEx("TinyBurningPiece3",random(-35,35),random(-35,35))
		TNT1 A 0 A_SpawnItemEx("TinyBurningPiece",random(-5,5),random(-5,5))
		TNT1 AAAAAAAAAAAAAA 0 A_CustomMissile("ExplosionParticleHeavy",30,0,random(0,360),2,random(0,180))
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_CustomMissile("ExplosionParticleHeavy",30,0,random(0,360),2,random(0,360))
		TNT1 AAAAA 0 A_CustomMissile("ExplosionParticleVeryFast",30,0,random(0,360),2,random(0,360))
		TNT1 AA 0 A_CustomMissile("CarbonizedSmoke1",30,0,random(0,360),2,random(10,90))
		PTXC GHI 3
		TNT1 A 0 A_SpawnItem("BarrelExplosionSmokeColumn")
		PTXC JKL 3 A_CustomMissile("ExplosionSmoke",20,0,random(0,180),2,random(0,180))
		PTXC LLLLLLLLLLLL 7 A_CustomMissile("PlasmaSmoke",10,0,random(0,360),2,random(5,160))
		PTXC LLLLLLLLLLLL 11 A_CustomMissile("PlasmaSmoke",10,0,random(0,360),2,random(5,160))
		PTXC LLLLLLLLLLLL 15 A_CustomMissile("PlasmaSmoke",10,0,random(0,360),2,random(5,160))
		PTXC L -1
		Stop
	}
}

ACTOR WraithSmoke
{
Scale 1.0
Height 0
Radius 0
Mass 0
Speed 1
Alpha 0.3
Renderstyle Add
+NOBLOCKMAP
+NOTELEPORT
+DONTSPLASH
+MISSILE
+FORCEXYBILLBOARD
+CLIENTSIDEONLY
+NOINTERACTION
+NOGRAVITY
+DOOMBOUNCE
+THRUACTORS
BounceFactor 0.5
	States
	{
	Spawn:
		TNT1 A 0 NoDelay A_SetScale(frandom(0.9,1.2))//Random scale
		TNT1 A 0 A_Jump(128,2)
		TNT1 A 0 A_SetScale(-1*scaleX,scaleY)//Random X-flip
		TNT1 A 0 A_Jump(128,2)
		TNT1 A 0 A_SetScale(scaleX,-1*scaleY)//Random Y-flip
		Goto Death
	Death:
		SMK3 ABCDEFGHIJKLM 1
		Stop
	}
}

//Wraith Tokens
Actor WraithTeleportCooldown :	Inventory{Inventory.MaxAmount 15}
Actor FireSeq :					Inventory{Inventory.MaxAmount 1}
Actor MonsterHaveSeenPlayer :	Inventory{Inventory.MaxAmount 1}